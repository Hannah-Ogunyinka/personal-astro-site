---
import "../../styles/posts.css";
import Header from "../../components/header-white.astro";
import Head from "../../components/head.astro";
import { Image } from "astro:assets";
import { type CollectionEntry, getCollection } from "astro:content";

export async function getStaticPaths() {
  const postCollection = await getCollection("posts", ({ data }) => {
    return !data.isDraft;
  });
  return postCollection.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<"posts">;
}

const { post } = Astro.props;
const { title, description, publishDate, tags, postImage1md, postImage1mdalt } =
  post.data;
const postImage = postImage1md as ImageMetadata;
const { Content } = await post.render();

const inputDate = new Date(publishDate);
const day = inputDate.getDate();
const monthNames = [
  "Jan",
  "Feb",
  "Mar",
  "Apr",
  "May",
  "Jun",
  "Jul",
  "Aug",
  "Sep",
  "Oct",
  "Nov",
  "Dec",
];
const month = monthNames[inputDate.getMonth()];
const year = inputDate.getFullYear();
const formattedDate = `${day} ${month} ${year}`;
---

<html lang="en">
  <Head />
  <body>
    <Header />
    <main class="inner-container-85rem flex">
      <aside></aside>
      <article class="flex">
        <div class="article-inner-wrapper">
          <h1>{title}</h1>
          <ul class="single-project__tag-list">
            {
              tags.map((tag: unknown) => (
                <li>
                  <span class="single-project__tag">{tag}</span>
                </li>
              ))
            }
          </ul>
          <div class="flex">
            <span class="preheading">published:</span>
            <span class="post-date">{formattedDate}</span>
          </div>
          <div class="cover-image-wrapper flex">
            <Image class="cover-image" src={postImage} alt={postImage1mdalt} />
          </div>
          <Content />
        </div>
      </article>
      <aside>
        <!-- <TableOfContents headings={headings} /> -->
      </aside>
    </main>
    <footer>
      <p>
        &copy<span class="footer-currentyear" id="currentYear">2027</span>
         Hannah Ogunyinka
      </p>
    </footer>

    <style>
      main {
        margin-top: 6rem;
      }

      article {
        width: 60%;
        justify-content: center;
      }

      aside {
        width: 20%;
      }

      @media (max-width: 1024px) {
        aside {
          display: none;
        }

        .article-inner-wrapper {
          max-width: 40rem;
        }

        article {
          width: 100%;
        }
      }

      .cover-image-wrapper {
        justify-content: flex-start;
        margin-block: 2rem;
      }
      .cover-image {
        max-width: 30rem;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .single-project__tag-list {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 1.5rem;
      }

      .single-project__tag {
        color: var(--secondary-color);
        letter-spacing: 0.1em;
        font-size: 0.8rem;
        margin-bottom: 1rem;
        font-weight: var(--fw-500);
        display: block;
        text-transform: uppercase;
        margin-right: 0.8em;
        background-color: var(--primary-color);
        border-radius: 2px;
        padding: 0.4em 0.9em;
      }
      .post-date {
        margin-left: 0.5rem;
        font-size: 1rem;
        text-transform: uppercase;
      }

      footer {
        background-color: var(--primary-color);
      }

      footer p {
        padding: 1rem;
        text-align: center;
        color: var(--secondary-color);
        font-weight: var(--fw-300);
        margin-bottom: 0;
      }

      .footer-currentyear {
        color: var(--accent-color);
      }
    </style>
    <script>
      import "../../scripts/nav.js";
      import "../../scripts/footer";
    </script>
  </body>
</html>
